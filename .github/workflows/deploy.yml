      - name: üì° Connexion SSH et d√©ploiement
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            set -e

            echo "üìå Passage au dossier..."
            cd ~/bmarket

            echo "üì¶ V√©rification de Docker Compose..."
            if ! command -v docker-compose &> /dev/null; then
              apt update && apt install -y docker-compose
            fi

            echo "üì¶ Pull de la nouvelle image..."
            docker login ghcr.io -u ${{ secrets.GHCR_USERNAME }} --password ${{ secrets.GHCR_TOKEN }}
            docker-compose pull || { echo "‚ùå Pull √©chou√©"; exit 1; }

            echo "üõë Arr√™t des anciens conteneurs..."
            docker-compose down || echo "‚ö†Ô∏è Aucun conteneur √† stopper"

            echo "üöÄ D√©marrage des nouveaux conteneurs..."
            docker-compose up -d || { echo "‚ùå D√©marrage √©chou√©"; exit 1; }

            echo "‚è≥ Attente que Postgres d√©marre (15s)..."
            sleep 15

            echo "üõ†Ô∏è Cr√©ation base de donn√©es si elle n'existe pas..."
            docker exec bmarket-postgres-1 bash -c "PGPASSWORD=$POSTGRES_PASSWORD psql -U $POSTGRES_USER -tc \"SELECT 1 FROM pg_database WHERE datname = '$POSTGRES_DB'\" | grep -q 1 || psql -U $POSTGRES_USER -c \"CREATE DATABASE $POSTGRES_DB;\""

            echo "üìÑ G√©n√©ration de .env.production..."
            cat <<EOF > .env.production
DATABASE_URL=${{ secrets.DATABASE_URL }}
NEXTAUTH_SECRET=${{ secrets.NEXTAUTH_SECRET }}
NEXTAUTH_URL=https://bmarket.fr
EOF

            echo "üìÇ Injection du .env.production dans le container..."
            docker cp .env.production bmarket-votre-app-1:/app/.env.production

            echo "üì¶ Prisma migrate deploy..."
            docker exec bmarket-votre-app-1 npx prisma migrate deploy || echo "‚ö†Ô∏è Prisma migration skipped"

            echo "‚úÖ D√©ploiement termin√© !"
